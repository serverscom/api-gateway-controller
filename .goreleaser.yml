---
before:
  hooks:
    - go mod tidy
builds:
  - id: api-gateway-controller
    dir: ./cmd
    env:
      - CGO_ENABLED=0
    goos:
      - linux
    goarch:
      - amd64
      - arm64
      - arm
    binary: api-gateway-controller
    ldflags:
      - "-s -w -X main.version={{ if not .IsSnapshot }}v{{ end }}{{ .Version }} -X main.gitCommit={{ .ShortCommit }}"

dockers:
  - build_flag_templates: [--platform=linux/amd64]
    dockerfile: Dockerfile
    goarch: amd64
    image_templates: ["ghcr.io/serverscom/api-gateway-controller:{{ if not .IsSnapshot }}v{{ end }}{{ .Version }}-amd64"]
    use: buildx
  - build_flag_templates: [--platform=linux/arm64]
    dockerfile: Dockerfile
    goarch: arm64
    image_templates: ["ghcr.io/serverscom/api-gateway-controller:{{ if not .IsSnapshot }}v{{ end }}{{ .Version }}-arm64v8"]
    use: buildx
  - build_flag_templates: [--platform=linux/arm/v6]
    dockerfile: Dockerfile
    goarch: arm
    goarm: 6
    image_templates: ["ghcr.io/serverscom/api-gateway-controller:{{ if not .IsSnapshot }}v{{ end }}{{ .Version }}-armv6"]

docker_manifests:
  - name_template: ghcr.io/serverscom/api-gateway-controller:{{ if not .IsSnapshot }}v{{ end }}{{ .Version }}
    image_templates:
      - ghcr.io/serverscom/api-gateway-controller:{{ if not .IsSnapshot }}v{{ end }}{{ .Version }}-amd64
      - ghcr.io/serverscom/api-gateway-controller:{{ if not .IsSnapshot }}v{{ end }}{{ .Version }}-arm64v8
      - ghcr.io/serverscom/api-gateway-controller:{{ if not .IsSnapshot }}v{{ end }}{{ .Version }}-armv6

release:
  ids: [""]
  draft: true
  extra_files:
    - glob: "./api-gateway-controller-*.tgz"
